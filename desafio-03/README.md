# API Sportivity

API para sistema de rede social sportivity.

## Funcionalidades da API

### REQ01 Cadastro de usuarios

- Rota: `POST /usuarios`

Deve enviar um body no seguinte formato:

```json
{
    "nome": "Teste 4",
    "email": "teste4@cwi.com.br",
    "urlImagem": "OPCIONAL",
    "apelido": "OPCIONAL" ,
    "senha": "123456",
    "dataNascimento": "2003-02-24"
}
```
Email deve ser único.

### REQ02 Autenticação

- Rota: `POST /login`

Deve enviar um usuario e senha via basicAuth.

- Rota: `POST /logout`

## ROTAS DO USUARIO [PRIVADO]

### Edição de usuario
- Rota: `PUT /usuarios/editarmeusdados`

Deve enviar um body no seguinte formato:

```json
{
    "nome": "Teste 4",
    "apelido": "OPCIONAL", 
    "urlImagem": ""
}
```

### Pesquisa de usuario
- Rota: `GET /usuarios/pesquisar?texto={texto}`

Listagem paginada.

Parâmetros:
- texto (opcional): texto para ser usado na pesquisa.

### Detalhar usuario especifico
- Rota: `GET /usuarios/{ID}/detalhes`

Parâmetros:
- Id (obrigatório): ‘id’ do usuario a ser detalhado.

### Detalhar usuario autenticado

- Rota: `GET /usuarios/me`

## ROTAS AMIZADES [PRIVADO]

### Remove uma amizade

- Rota: `DELETE /usuarios/removeramizade/{id}`

Parâmetros:
- Id (obrigatório): ‘id’ da amizade a ser removida.

### Enviar uma solicitação de amizade

- Rota: `PUT /usuarios/{id}/enviaramizade`

Parâmetros:
- Id (obrigatório): ‘id’ do usuario a ser adicionado.

### Aceitar uma solicitação de amizade

- Rota: `PUT /usuarios/aceitaramizade/3`

Parâmetros:
- Id (obrigatório): ‘id’ da amizade a ser adicionada.

### Listar solicitacoes recebidas

- Rota: `GET /usuarios/solicitacoesrecebidas`

### Listar Amigos

- Rota: `GET /usuarios/amigos?texto=`

Listagem paginada.

Parâmetros:
- Texto (opcional): texto a ser usado para pesquisar algum amigo.

## ROTAS POSTAGEM [PRIVADO]

### Curtir postagem

- Rota: `PUT /postagens/{id}/curtir`

Parâmetros:
- Id (obrigatório): ‘id’ da postagem a ser curtida.

### Descurtir postagem

- Rota: `PUT /postagens/{id}/descurtir`

Parâmetros:
- Id (obrigatório): ‘id’ da postagem a ser descurtida.

### Editar postagem

- Rota: `PUT /postagens/{id}`

Parâmetros:
- Id (obrigatório): ‘id’ da postagem a ser editada.

Deve enviar um body com os seguintes dados:

```json
{
    "conteudo": "9 da matina, o dia tá pra começar",
    "urlImagem":  "OPCIONAL",
    "isPrivado": true
}
```

### Remover postagem

- Rota: `DELETE /postagens/{id}`

Parâmetros:
- Id (obrigatório): ‘id’ da postagem a ser removida.


### Listar postagens

- Rota: `GET /postagens`

Retorna as postagens de forma paginada.


### Incluir postagem

- Rota: `POST /postagens`

Deve enviar um body com a seguinte estrutura:

```json
{
    "conteudo": "9 da matina, o dia tá pra começar",
    "urlImagem": "OPCIONAL",
    "isPrivado":false
}
```

### Comentar postagem

- Rota: `POST /postagens/{id}/comentar`

Parâmetros:
- Id (obrigatório): ‘id’ da postagem a ser comentada.

Deve-se enviar um requestBody com a seguinte estrutura:
```json
{
    "conteudo": "Esse aí ficou brabo, rei."
}
```

### Listar comentários da postagem

- Rota: `GET /postagens/{id}/comentarios`

Parâmetros:
- Id (obrigatório): ‘id’ da postagem a ter comentários listados.

## SCHEMA:
```sql
DROP TABLE IF EXISTS usuario CASCADE;
DROP TABLE IF EXISTS amizade CASCADE;
DROP TABLE IF EXISTS postagem CASCADE;
DROP TABLE IF EXISTS curtida CASCADE;
DROP TABLE IF EXISTS comentario CASCADE;
DROP TABLE IF EXISTS permissao CASCADE;

CREATE TABLE usuario (
    id BIGINT GENERATED ALWAYS AS IDENTITY,
    nome VARCHAR(255) 			  NOT NULL,
    email VARCHAR(255) 			  NOT NULL,
    apelido VARCHAR(50),
    senha VARCHAR(128) 		      NOT NULL,
    url_imagem VARCHAR(512),
    data_nascimento DATE NOT NULL,
	is_ativo BOOLEAN NOT NULL DEFAULT FALSE,

	CONSTRAINT pk_usuario_id PRIMARY KEY(id),
	CONSTRAINT uk_email_usuario UNIQUE(email)
);

CREATE TABLE permissao (
	id BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL,
	funcao VARCHAR(100) NOT NULL,
	usuario_id BIGINT NOT NULL,
	CONSTRAINT pk_permissao PRIMARY KEY (id),
	CONSTRAINT uk_permissao UNIQUE (funcao, usuario_id),
	CONSTRAINT fk_permissao_usuario FOREIGN KEY (usuario_id) REFERENCES usuario
);

CREATE TABLE amizade (
    id BIGINT GENERATED ALWAYS AS IDENTITY,
    usuario_id BIGINT NOT NULL,
    amigo_id BIGINT NOT NULL,
    data_amizade TIMESTAMP NOT NULL,
	status VARCHAR(20) NOT NULL DEFAULT 'PENDENTE',

	CONSTRAINT pk_amizade_id PRIMARY KEY(id),
	CONSTRAINT uk_amizade UNIQUE(usuario_id, amigo_id),
	CONSTRAINT fk_usuario_id FOREIGN KEY(usuario_id) REFERENCES usuario(id),
	CONSTRAINT fk_amigo_id FOREIGN KEY(usuario_id) REFERENCES usuario(id),
	CONSTRAINT status_check CHECK (status IN ('PENDENTE', 'ACEITO'))
);


CREATE TABLE postagem (
    id BIGINT GENERATED ALWAYS AS IDENTITY,
    usuario_id BIGINT NOT NULL,
    conteudo VARCHAR(500) NOT NULL,
	url_imagem VARCHAR(512),
    data_postagem TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
	is_privado BOOLEAN NOT NULL DEFAULT FALSE,

	CONSTRAINT pk_postagem_id PRIMARY KEY(id),
	CONSTRAINT fk_usuario_id FOREIGN KEY(usuario_id) REFERENCES usuario(id)
);


CREATE TABLE curtida (
    id BIGINT GENERATED ALWAYS AS IDENTITY,
    usuario_id BIGINT NOT NULL,
    postagem_id BIGINT NOT NULL,
    horario_curtida TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,

	CONSTRAINT pk_curtida_id PRIMARY KEY(id),
	CONSTRAINT fk_usuario_id FOREIGN KEY(usuario_id)  REFERENCES usuario(id),
	CONSTRAINT fk_postagem_id FOREIGN KEY(postagem_id) REFERENCES postagem(id),
	CONSTRAINT uk_usuario_curtida_postagem UNIQUE(usuario_id, postagem_id)
);


CREATE TABLE comentario (
  id BIGINT GENERATED ALWAYS AS IDENTITY,
  usuario_id BIGINT NOT NULL,
  postagem_id BIGINT NOT NULL,
  conteudo VARCHAR(500) NOT NULL,
  data_criacao TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,

  CONSTRAINT pk_comentario_id PRIMARY KEY(id),
  CONSTRAINT pk_postagem_id FOREIGN KEY(postagem_id) REFERENCES postagem(id),
  CONSTRAINT fk_usuario_id FOREIGN KEY(usuario_id) REFERENCES usuario(id)
);


```
